---
name: Add News

on:
  issue_comment:
    types:
      - created      

jobs:
  check:
    if: >-
      !github.event.repository.fork && (
        github.event.comment.body == 'please add news'
        || github.event_name == 'pull_request_target'
      )

    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v2
 
      - name: Extract branch name
        id: extract_branch
        uses: tj-actions/branch-names@v6
      
      - name: Print Pull Request Branch Name to Output
        run: |
          echo "Pull Request Branch Name: ${{ steps.extract_branch.outputs.branch }}"
        env:
          BRANCH_NAME: ${{ steps.extract_branch.outputs.branch }}

      - name: Create a New File With Pull Request Number and PR Branch Name in the File Name
        uses: 1arp/create-a-file-action@0.2
        with:
          file: "news/${{ github.event.issue.number }}_${{ steps.extract_branch.outputs.branch }}"
          content: |
            ### Enhancements
            * <news item>
            ### Bug fixes            
            * <news item>            
            ### Deprecations            
            * <news item>            
            ### Docs            
            * <news item>            
            ### Other            
            * <news item>

      - name: Commit and Add New News File to the Pull Request
        uses: EndBug/add-and-commit@v7
        with:
          author_name: ${{ github.actor }}
          author_email: ${{ github.actor }}@users.noreply.github.com
          message: "Add news file to this PR"
          add: "news/${{ github.event.issue.number }}_${{ steps.extract_branch.outputs.branch }}"
          branch: ${{ steps.extract_branch.outputs.branch }}
